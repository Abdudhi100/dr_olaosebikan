{% extends "base.html" %}
{% load widget_tweaks %}

{% block content %}
<section class="max-w-3xl mx-auto px-4 py-14">
  <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8">
    <h1 class="text-3xl font-extrabold text-slate-900">Book an Appointment</h1>
    <p class="mt-2 text-slate-600">Choose a service, pick a date, then select an available time.</p>

    <form method="post" class="mt-8 space-y-6">
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="rounded-lg bg-red-50 border border-red-200 p-4 text-red-700">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      <div class="grid gap-5 sm:grid-cols-2">
        <div>
          <label class="block text-sm font-semibold text-slate-700">Full name</label>
          {{ form.patient_name|add_class:"mt-1 w-full rounded-lg border-slate-300 focus:border-blue-600 focus:ring-blue-600" }}
          {{ form.patient_name.errors }}
        </div>

        <div>
          <label class="block text-sm font-semibold text-slate-700">Email</label>
          {{ form.patient_email|add_class:"mt-1 w-full rounded-lg border-slate-300 focus:border-blue-600 focus:ring-blue-600" }}
          {{ form.patient_email.errors }}
        </div>
      </div>

      <div class="grid gap-5 sm:grid-cols-2">
        <div>
          <label class="block text-sm font-semibold text-slate-700">Phone (optional)</label>
          {{ form.patient_phone|add_class:"mt-1 w-full rounded-lg border-slate-300 focus:border-blue-600 focus:ring-blue-600" }}
          {{ form.patient_phone.errors }}
        </div>

        <div>
          <label class="block text-sm font-semibold text-slate-700">Service</label>
          {{ form.service|add_class:"mt-1 w-full rounded-lg border-slate-300 focus:border-blue-600 focus:ring-blue-600" }}
          {{ form.service.errors }}
        </div>
      </div>

      <div class="grid gap-5 sm:grid-cols-2">
        <div>
          <label class="block text-sm font-semibold text-slate-700">Date</label>
          {{ form.date|add_class:"mt-1 w-full rounded-lg border-slate-300 focus:border-blue-600 focus:ring-blue-600" }}
          {{ form.date.errors }}
        </div>

        <div>
          <label class="block text-sm font-semibold text-slate-700">Time</label>

          <!-- HTMX: whenever service or date changes, fetch slot options -->
          <select
            name="start_time"
            id="id_start_time"
            class="mt-1 w-full rounded-lg border-slate-300 focus:border-blue-600 focus:ring-blue-600"
            hx-get="{% url 'appointments:slots' %}"
            hx-trigger="load, change from:#id_service, change from:#id_date"
            hx-target="#id_start_time"
            hx-include="#id_service,#id_date"
          >
            {% for val, label in form.fields.start_time.choices %}
              <option value="{{ val }}">{{ label }}</option>
            {% endfor %}
          </select>

          {{ form.start_time.errors }}
          <p class="mt-2 text-sm text-slate-500">Available times are generated automatically.</p>
        </div>
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700">Notes (optional)</label>
        {{ form.notes|add_class:"mt-1 w-full rounded-lg border-slate-300 focus:border-blue-600 focus:ring-blue-600" }}
        {{ form.notes.errors }}
      </div>

      <button class="w-full sm:w-auto inline-flex items-center justify-center rounded-xl bg-blue-600 px-6 py-3 font-semibold text-white hover:bg-blue-700">
        Submit booking request
      </button>

      <p class="text-sm text-slate-500">
        After booking, you and Dr Olaosebikan will receive an email. If he becomes unavailable, he will contact you personally.
      </p>
    </form>
  </div>
</section>
{% endblock %}
