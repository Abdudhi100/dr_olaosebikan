<!-- templates/partials/navbar.html -->
<nav
  x-data="{ open: false }"
  x-init="$watch('open', v => document.body.classList.toggle('overflow-hidden', v))"
  @keydown.escape.window="open = false"
  role="navigation"
  aria-label="Primary"
  class="sticky top-0 z-50 bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/70 ring-1 ring-slate-200/70"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6">
    <div class="flex h-16 items-center justify-between">

      <!-- ================= BRAND ================= -->
      <div class="flex items-center gap-3">
        <a href="{% url 'core_app:home' %}"
           class="group inline-flex items-center gap-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-600">

          <!-- Logo mark -->
          <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-blue-600 text-white font-extrabold tracking-tight shadow-sm shadow-blue-600/20">
            <span class="text-sm">
              {{ clinic.logo_text|default:"PA" }}
            </span>
          </div>

          <!-- Name + tagline -->
          <div class="leading-tight">
            <div class="text-base font-extrabold text-slate-900 group-hover:text-blue-700 transition">
              {{ clinic.clinic_name|default:"Resilience Clinic" }}
            </div>
            <div class="hidden sm:block text-xs text-slate-500">
              {{ clinic.clinic_tagline|default:"Care you can trust • Fast appointments" }}
            </div>
          </div>
        </a>
      </div>

      <!-- ================= DESKTOP NAV ================= -->
      <div class="hidden md:flex items-center gap-8">
        <a href="{% url 'core_app:home' %}#services"
           class="text-sm font-semibold text-slate-700 hover:text-blue-700 transition focus:outline-none focus:ring-2 focus:ring-blue-600 rounded">
          Services
        </a>

        <a href="{% url 'publications:publication_list' %}"
           class="text-sm font-semibold text-slate-700 hover:text-blue-700 transition focus:outline-none focus:ring-2 focus:ring-blue-600 rounded">
          Resources
        </a>

        <a href="{% url 'core_app:contact' %}"
           class="text-sm font-semibold text-slate-700 hover:text-blue-700 transition focus:outline-none focus:ring-2 focus:ring-blue-600 rounded">
          Contact
        </a>

        <!-- ================= AUTH ACTIONS ================= -->
        <div class="flex items-center gap-2 pl-4 border-l border-slate-200">
          {% if request.user.is_authenticated %}
            <a href="{% url 'accounts:dashboard' %}"
               class="inline-flex items-center rounded-xl px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100 transition focus:outline-none focus:ring-2 focus:ring-blue-600">
              Patient Portal
            </a>

            <form method="post" action="{% url 'accounts:logout' %}">
              {% csrf_token %}
              <button type="submit"
                      class="inline-flex items-center rounded-xl px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100 transition focus:outline-none focus:ring-2 focus:ring-blue-600">
                Logout
              </button>
            </form>
          {% else %}
            <a href="{% url 'accounts:login' %}"
               class="inline-flex items-center rounded-xl px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100 transition focus:outline-none focus:ring-2 focus:ring-blue-600">
              Login
            </a>

            <a href="{% url 'accounts:register' %}"
               class="inline-flex items-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800 transition focus:outline-none focus:ring-4 focus:ring-slate-300">
              Register
            </a>
          {% endif %}
        </div>

        <!-- ================= PRIMARY CTA ================= -->
        <a href="{% url 'appointments:book' %}"
           class="inline-flex items-center rounded-xl bg-blue-600 px-5 py-2.5 text-sm font-semibold text-white hover:bg-blue-700 transition focus:outline-none focus:ring-4 focus:ring-blue-300 shadow-sm shadow-blue-600/20">
          Book Appointment
        </a>
      </div>

      <!-- ================= MOBILE TOGGLE ================= -->
      <button
        @click="open = true"
        type="button"
        class="md:hidden inline-flex items-center justify-center rounded-xl p-2 text-slate-700 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-600"
        aria-controls="mobile-menu"
        :aria-expanded="open.toString()"
        aria-label="Open main menu"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none"
             viewBox="0 0 24 24" stroke-width="2"
             stroke="currentColor" class="h-6 w-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>

    </div>
  </div>

  <!-- ================= MOBILE OVERLAY ================= -->
  <div
    x-cloak
    x-show="open"
    x-transition.opacity
    id="mobile-menu"
    class="md:hidden fixed inset-0 z-[70]"
    aria-modal="true"
    role="dialog"
  >
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/40" @click="open = false" aria-hidden="true"></div>

    <!-- Slide-in Panel -->
    <div
      class="absolute right-0 top-0 h-full w-80 max-w-[88vw] bg-white shadow-2xl p-6 flex flex-col"
      x-transition:enter="transition ease-out duration-200"
      x-transition:enter-start="translate-x-full"
      x-transition:enter-end="translate-x-0"
      x-transition:leave="transition ease-in duration-150"
      x-transition:leave-start="translate-x-0"
      x-transition:leave-end="translate-x-full"
    >
      <!-- Header -->
      <div class="flex items-start justify-between gap-4 mb-6">
        <div class="min-w-0">
          <div class="font-extrabold text-slate-900 truncate">
            {{ clinic.clinic_name|default:"Resilience Clinic" }}
          </div>
          <div class="hidden sm:block text-xs text-slate-500">
            {{ clinic.clinic_tagline|default:"Care you can trust • Fast appointments" }}
          </div>
        </div>

        <button
          @click="open = false"
          class="rounded-xl p-2 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-600"
          aria-label="Close menu"
        >
          ✕
        </button>
      </div>

      <!-- Auth card -->
      <div class="mb-6 rounded-2xl border border-slate-200 p-4">
        {% if request.user.is_authenticated %}
          <div class="text-sm text-slate-600">Signed in as</div>
          <div class="font-semibold text-slate-900 truncate">{{ request.user.get_username }}</div>

          <div class="mt-4 flex gap-2">
            <a @click="open = false"
               href="{% url 'accounts:dashboard' %}"
               class="flex-1 inline-flex items-center justify-center rounded-xl bg-slate-900 px-4 py-2.5 text-white font-semibold hover:bg-slate-800 transition">
              Patient Portal
            </a>

            <form class="flex-1" method="post" action="{% url 'accounts:logout' %}">
              {% csrf_token %}
              <button type="submit"
                      class="w-full inline-flex items-center justify-center rounded-xl border border-slate-300 px-4 py-2.5 font-semibold text-slate-800 hover:bg-slate-50 transition">
                Logout
              </button>
            </form>
          </div>
        {% else %}
          <div class="text-sm font-semibold text-slate-900">Patient account</div>
          <p class="mt-1 text-sm text-slate-600">Login to manage bookings and view your history.</p>

          <div class="mt-4 flex gap-2">
            <a @click="open = false"
               href="{% url 'accounts:login' %}"
               class="flex-1 inline-flex items-center justify-center rounded-xl border border-slate-300 px-4 py-2.5 font-semibold text-slate-800 hover:bg-slate-50 transition">
              Login
            </a>

            <a @click="open = false"
               href="{% url 'accounts:register' %}"
               class="flex-1 inline-flex items-center justify-center rounded-xl bg-slate-900 px-4 py-2.5 text-white font-semibold hover:bg-slate-800 transition">
              Register
            </a>
          </div>
        {% endif %}
      </div>

      <!-- Links -->
      <nav class="flex flex-col gap-1 text-sm font-semibold text-slate-800">
        <a @click="open = false"
           href="{% url 'core_app:home' %}#services"
           class="rounded-xl px-3 py-2 hover:bg-slate-50">
          Services
        </a>

        <a @click="open = false"
           href="{% url 'publications:publication_list' %}"
           class="rounded-xl px-3 py-2 hover:bg-slate-50">
          Resources
        </a>

        <a @click="open = false"
           href="{% url 'core_app:contact' %}"
           class="rounded-xl px-3 py-2 hover:bg-slate-50">
          Contact
        </a>

        <!-- Primary CTA -->
        <a @click="open = false"
           href="{% url 'appointments:book' %}"
           class="mt-5 inline-flex items-center justify-center rounded-2xl bg-blue-600 px-4 py-3 text-white font-semibold hover:bg-blue-700 transition shadow-sm shadow-blue-600/20">
          Book Appointment
        </a>

        <!-- Secondary CTA -->
        {% if clinic.contact_phone %}
        <a @click="open = false"
           href="tel:{{ clinic.contact_phone }}"
           class="mt-2 inline-flex items-center justify-center rounded-2xl border border-slate-300 px-4 py-3 font-semibold text-slate-900 hover:bg-slate-50 transition">
          Call the clinic
        </a>
        {% endif %}

        {% if clinic.whatsapp_number %}
        <a @click="open = false"
           href="https://wa.me/{{ clinic.whatsapp_number }}"
           class="mt-2 inline-flex items-center justify-center rounded-2xl border border-slate-300 px-4 py-3 font-semibold text-slate-900 hover:bg-slate-50 transition">
          WhatsApp
        </a>
        {% endif %}
      </nav>

      <div class="mt-auto pt-6 text-xs text-slate-500">
        © {{ clinic.clinic_name|default:"Resilience Clinic" }} • Open Mon–Sat
      </div>
    </div>
  </div>
</nav>
